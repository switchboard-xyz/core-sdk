<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Data Feed Best Practices | Switchboard</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.switchboard.xyz/img/documentation_card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.switchboard.xyz/img/documentation_card.jpg"><meta data-rh="true" property="og:url" content="https://docs.switchboard.xyz/blog/2022/08/04/Data-Feed-Best-Practices"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Data Feed Best Practices | Switchboard"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-08-04T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://twitter.com/gallynaut"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.switchboard.xyz/blog/2022/08/04/Data-Feed-Best-Practices"><link data-rh="true" rel="alternate" href="https://docs.switchboard.xyz/blog/2022/08/04/Data-Feed-Best-Practices" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.switchboard.xyz/blog/2022/08/04/Data-Feed-Best-Practices" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://XO84KDTPTB-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Switchboard RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Switchboard Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Switchboard" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.63362a7a.css">
<link rel="preload" href="/assets/js/runtime~main.d439857d.js" as="script">
<link rel="preload" href="/assets/js/main.df7f9c98.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_yzxH" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Switchboard Logo" class="themedImage_iiVx themedImage--light_rFMV" height="72" width="72"><img src="/img/logo_white.svg" alt="Switchboard Logo" class="themedImage_iiVx themedImage--dark_SaTe" height="72" width="72"></div><b class="navbar__title text--truncate">Switchboard</b></a><a class="navbar__item navbar__link" href="/about">Docs</a><a class="navbar__item navbar__link" href="/api">API</a><div class="searchBox_aTcI"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://github.com/switchboard-xyz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar_icon__github" aria-label="GitHub repository"></a><a href="https://twitter.com/switchboardxyz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar_icon__twitter" aria-label="Twitter Link"></a><div class="toggle_VBYi colorModeToggle_ZPBD"><button class="clean-btn toggleButton_NXMR toggleButtonDisabled_Lyab" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_XFIB"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_JTM9"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_Fn2L"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_vwz3 thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_Rvql margin-bottom--md">All posts</div><ul class="sidebarItemList_jqku clean-list"><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2023/05/03/Switchboard-Oracle-on-Sui-Mainnet">Switchboard Oracle on Sui Mainnet</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2023/04/19/Introduction-to-Switchboard-Serverless">Introduction to Switchboard Serverless</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2023/04/06/Dialed-in-with-Switchboard">Dialed in with Switchboard: April 06, 2023</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2023/03/30/Switchboard-v3">Switchboard v3</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2023/02/23/Switchboard-Oracle-on-Core-Mainnet-Alpha">Switchboard Oracle on Core Mainnet Alpha</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2023/02/02/PluggedintoStarkNet">#PluggedintoStarkNet</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2023/01/26/PluggedintoCore">#PluggedintoCore</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/12/31/Switchboard-Wrap-Up-2022">Switchboard Wrap Up 2022</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/12/26/Data-Feed-Priority-Fees-and-Sliding-Window-on-Solana">Data Feed Priority Fees and Sliding Window on Solana</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/12/06/Building-and-Managing-Data-Feeds-through-Multisig-Soltuions">Building and Managing Data Feeds through Multisig Soltuions</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/11/01/PluggedintoSui">#PluggedintoSui</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/10/26/Switchboard-Oracle-on-NEAR-Mainnet-Alpha">Switchboard Oracle on Near Mainnet Alpha</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/10/18/Switchboard-Oracle-on-Aptos-Mainnet">Switchboard Oracle on Aptos Mainnet</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/09/13/PluggedintoNEAR">#PluggedintoNEAR</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/09/01/PluggedintoAptos">#PluggedintoAptos</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/08/29/Switchboard-360-Looking-Back-Forward-and-All-Around">Switchboard 360: Looking Back, Forward and All Around</a></li><li class="sidebarItem_QgSO"><a aria-current="page" class="sidebarItemLink_mxj2 sidebarItemLinkActive_BMv6" href="/blog/2022/08/04/Data-Feed-Best-Practices">Data Feed Best Practices</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/07/13/Verifiable-Randomness-on-Solana">Verifiable Randomness (VRF) on Solana</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/06/22/Switchboard-Publisher">Switchboard Publisher</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/05/23/Dialed-in-with-Switchboard">Dialed in with Switchboard: May 23, 2022</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/04/18/Dialed-in-with-Switchboard">Dialed in with Switchboard: April 18, 2022</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/03/14/Dialed-in-with-Switchboard">Dialed in with Switchboard: March 14, 2022</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/03/07/Dialed-in-with-Switchboard">Dialed in with Switchboard: March 07, 2022</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/02/25/Switchboard-Riptide-Prizes-Announcement">Switchboard x Riptide Prizes Announcement</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/02/23/Using-Switchboard-Creating-Custom-Data-Feeds">Using Switchboard: Creating Custom Data Feeds</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/02/07/Switchboard-Introduces-TWAP-Support">Switchboard Introduces TWAP Support</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/01/27/Switchboard-V2-is-LIVE">Switchboard V2 is LIVE!</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2022/01/20/Fair-LP-Token-Oracles">Fair LP Token Oracles</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2021/11/03/Switchboard-V2-Incentives">Switchboard V2 (pt.3) — Incentives</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2021/10/12/Switchboard-V2-Architecture-and-Data-Flows">Switchboard V2 (pt.2) — Architecture and Data Flows</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2021/10/04/Switchboard-x-GRAPE-Network">Switchboard x GRAPE Network</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2021/09/30/Switchboard-V2-Roles-and-Responsibilities">Switchboard V2 (pt. 1) — Roles and Responsibilities</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2021/09/22/Intro-to-Switchboard">Intro to Switchboard</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2021/06/28/Switchboard-Partners-with-Genesis-Volatility">Switchboard partners with Genesis Volatility to provide on-chain volatility data on Solana</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2021/06/17/Switchboard-Raises-3.5MM-Seed">Switchboard raises 3.5MM seed and announces Solana Mainnet Beta</a></li><li class="sidebarItem_QgSO"><a class="sidebarItemLink_mxj2" href="/blog/2021/05/25/Introducing-Switchboard">Introducing Switchboard</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_zFc6" itemprop="headline">Data Feed Best Practices</h1><div class="container_BSNm margin-vert--md"><time datetime="2022-08-04T00:00:00.000Z" itemprop="datePublished">August 4, 2022</time> · <!-- -->17 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_E1Cj"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/gallynaut" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://pbs.twimg.com/profile_images/1649642820993679365/buRwDkVY_400x400.jpg" alt="gallynaut"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/gallynaut" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">gallynaut</span></a></div><small class="avatar__subtitle" itemprop="description">Developer Relations</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Oracles are not a one size fit all solution, in fact redundancy should be used
depending on your use cases and risk tolerance</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/3200/1*mw9LjHRBP_O1ebxh9BhSqw.jpeg" class="img_eYgV"></p><p>Developers building real world applications for web3 rely on oracles to relay
and publish data on-chain. Oracles are not a one size fit all solution, in fact
redundancy should be used depending on your use cases and risk tolerance.
Switchboard’s goal is to generalize data feeds and leave it up to the developer
to configure and tune their data flow. Today’s article looks at how Switchboard
feeds differ from other providers, and how you can configure your data feed to
increase economic security.</p><p>We also have an infographic which summarizes this article:
<a href="https://docs.switchboard.xyz/img/Data_Feed_Best_Practices.png" target="_blank" rel="noopener noreferrer">https://docs.switchboard.xyz/img/Data_Feed_Best_Practices.png</a></p><h2 class="anchor anchorWithStickyNavbar_g2jJ" id="oracles-overview">Oracles Overview<a href="#oracles-overview" class="hash-link" aria-label="Direct link to Oracles Overview" title="Direct link to Oracles Overview">​</a></h2><p>A Switchboard feed belongs to a single oracle queue, which is a realm of oracles
that get assigned to update requests in a round-robin fashion. The feed’s config
dictates how update requests are invoked and routed through the network, along
with a set of job accounts that define how data is sourced off-chain.
Switchboard data feeds can fetch data from http endpoints, websockets, or
on-chain sources. Switchboard feeds are meant to be generic enough to meet any
use case and leave it up to the on-chain consumers to configure.</p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="oracle-consensus">Oracle Consensus<a href="#oracle-consensus" class="hash-link" aria-label="Direct link to Oracle Consensus" title="Direct link to Oracle Consensus">​</a></h3><p>Switchboard uses rounds to open and close a batch of oracle responses. A
Switchboard feed has a specified <strong><em>minUpdateDelay</em></strong> which determines the
minimum time a round is open for in order to give the oracles enough time to
respond. When a new round is opened, the data feed gets assigned to a new batch
of oracles, which is configurable with the parameter
<strong><em>oracleRequestBatchSize</em></strong>. After <strong><em>minOracleResults</em></strong> responses are
received, the on-chain program calculates the result using the median of the
oracle responses. The median ensures large outliers do not drastically skew the
accepted result, unlike averages. Oracles who responded within the queue’s
configured parameters are rewarded, while the oracles who respond outside this
threshold are slashed (if the queue has slashingEnabled). As you can see, the
oracle consensus can be configured by the downstream user to provide the
security necessary for their use case. Check out the
<a href="https://docs.switchboard.xyz/feed" target="_blank" rel="noopener noreferrer">data feed docs</a> for more information on the
lifecycle of Switchboard data feed updates.</p><p>This differs from other oracle solutions like Pyth where data feeds are sourced
from trusted market participants directly. This results in a faster update rate
but makes no guarantees on the number of sources that responded. With
Switchboard feeds you can guarantee a set number of sources and oracles have
responded before accepting the result on-chain.</p><h2 class="anchor anchorWithStickyNavbar_g2jJ" id="democratizing-data-feeds">Democratizing Data Feeds<a href="#democratizing-data-feeds" class="hash-link" aria-label="Direct link to Democratizing Data Feeds" title="Direct link to Democratizing Data Feeds">​</a></h2><p>Switchboard is a decentralized protocol that allows users to publish and request
updates from a pool of oracles. Switchboard oracles allocate their resources to
updates requested from on-chain consumers. This leaves it up to the consumer to
decide what data is brought on-chain.</p><p>Switchboard feeds are public meaning anyone is free to read the value on-chain
so sometimes it is ideal to piggy back on an existing feed. This works well for
some protocols but leaves you vulnerable to sudden changes in your on-chain data
flow. This is a risk vector that can be mitigated by owning your own data feed
and being your feed’s authority.</p><p>If you’re using a public data feed, consider contributing to the feeds lease to
extend its lifetime.</p><p>💡 <strong>NOTE</strong>: The feed authority differs from the lease authority. Only the lease
authority is permitted to withdraw funds. When contributing to public leases
check the lease authority is set to an empty public key or else the feed
authority could withdraw the funds for themselves.</p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="own-your-data">Own Your Data<a href="#own-your-data" class="hash-link" aria-label="Direct link to Own Your Data" title="Direct link to Own Your Data">​</a></h3><p>The feed authority has the power to modify the feed, including:</p><ul><li><p>change the job definitions and adapt to market conditions such as if a new
exchange siphoned volume from the current sources</p></li><li><p>speed up or slow down the feed depending on changing use cases</p></li><li><p>change the reporting parameters to save on cost</p></li><li><p>move the feed to a new queue for increased security or reliability</p></li><li><p>complete ownership over your on-chain data flow</p></li></ul><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="dao">DAO<a href="#dao" class="hash-link" aria-label="Direct link to DAO" title="Direct link to DAO">​</a></h3><p>A feed authority could even be set to a DAO where the quorum votes on changes to
a feeds configuration. This is true decentralization at play where the settings
of a feed are optimized for a variety of use cases where voting power could be
controlled by lease contributions or tokens staked.</p><h2 class="anchor anchorWithStickyNavbar_g2jJ" id="tuning-a-switchboard-feed">Tuning a Switchboard Feed<a href="#tuning-a-switchboard-feed" class="hash-link" aria-label="Direct link to Tuning a Switchboard Feed" title="Direct link to Tuning a Switchboard Feed">​</a></h2><p>Now that we have some background on how switchboard oracles publish data
on-chain, let’s look at how to configure a Switchboard feed.</p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="data-source-diversity">Data Source Diversity<a href="#data-source-diversity" class="hash-link" aria-label="Direct link to Data Source Diversity" title="Direct link to Data Source Diversity">​</a></h3><p>The first step when building a feed is determining where you are sourcing your
data from. Each data source should correspond to a job account, which is just a
collection of <a href="https://docs.switchboard.xyz/api/tasks" target="_blank" rel="noopener noreferrer">Switchboard tasks</a>, used
to instruct the oracles on how to fetch and transform data. Checkout the
<a href="https://docs.switchboard.xyz/feed/directory" target="_blank" rel="noopener noreferrer">job directory</a> for some example
definitions. You can also view a catalog of curated job definitions in the
<a href="https://app.switchboard.xyz/" target="_blank" rel="noopener noreferrer">Switchboard publisher</a>.</p><ul><li><p><strong>Job Diversity</strong> — Ensure you’re sourcing data from multiple, reliable
sources.</p></li><li><p><strong>Job Weights</strong> — Add job weights for sources with a higher degree of truth,
such as exchanges where price discovery is likely to happen. Oracles submit
the weighted median as their final result so jobs with a higher weight have
more influence on the result.</p></li><li><p><strong>minJobResults</strong> — Ensure the oracles have a reliable set of data before
responding on-chain. If only 1 out of 12 sources respond, you will not have a
reliable result. But if you set this to 12 out of 12 and one of your sources
is failing, you will encounter a stale feed, so ensure you have some margin
for single source failures.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="queue-selection">Queue Selection<a href="#queue-selection" class="hash-link" aria-label="Direct link to Queue Selection" title="Direct link to Queue Selection">​</a></h3><p>You should select a queue that will provide your feed with a sufficient level of
security.</p><ul><li><p><strong>Oracle Reputation</strong> — you should select a queue with a proven track record
of honest reporting. Oracles store various
<a href="https://docs.switchboard.xyz/idl/types/OracleMetrics" target="_blank" rel="noopener noreferrer">metrics</a> on-chain that
can be used to determine their reliability. Oracles are assigned to update
request in a round robin fashion where assignment is pseudo-random but this
gives a fairly accurate picture of a queues overall reliability.</p></li><li><p><strong>Oracle minStake</strong> — you should select a queue that requires oracles to stake
a respectable sum of capital before joining the queue. This will be used to
slash oracles for misreporting feeds.</p></li><li><p><strong>Queue Reward</strong> — your selected queue should reward oracles sufficiently
enough such that they are incentivized to report honestly, yet not too high
where update request are prohibitively expensive. Switchboard DAO queues
currently use 12500 lamports as the oracle reward, per update request.</p></li><li><p><strong>Queue Permissions</strong> — high availability feeds should be on a queue where
<strong><em>unpermissionedFeedsEnabled</em></strong> is set to false. This prevents data feeds
from being able to join and spam the queue with update requests.</p></li><li><p><strong>Slashing</strong> — feeds securing financial applications should be on a queue with
<strong><em>slashingEnabled</em></strong> to dissuade oracles from malicious behavior.</p></li></ul><p>You may notice Switchboard DAO queues do not have all of these settings enabled
yet. Switchboard DAO queues currently rely on vetting trusted oracle operators
to bootstrap the network. As the network grows, the queues will be further
decentralized and rely on these parameters to enforce security. Stay tuned for
more information on the Switchboard DAO and how new oracles will be permitted by
the network.</p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="data-availability">Data Availability<a href="#data-availability" class="hash-link" aria-label="Direct link to Data Availability" title="Direct link to Data Availability">​</a></h3><p>Configure when and how often you need new data on-chain.</p><ul><li><p><strong>Crank / Automatic Updates</strong> — any data feed that has sufficient queue
permissions is able to join a crank. A crank is a scheduling mechanism for
data feeds that will invoke a new round after each minUpdateDelay with some
added jitter to prevent predictable oracle assignment. Data feeds not on a
crank should set the option <strong><em>disableCrank</em></strong> and will need to manually
requests new updates or have their own scheduling mechanism.</p></li><li><p><strong>minUpdateDelay</strong> — determines how often new data can be requested on-chain.
This should be set depending on your use case. Decentralized exchanges will
need faster updates than a lending protocol.</p></li><li><p><strong>varianceThreshold</strong> — is the change percentage required between a previous
round and the current oracle result before a value is published on-chain. This
is used to conserve lease fees for the feed operator. Highly available feeds
should set this to 0 so values are always reported on-chain.</p></li><li><p><strong>forceReportPeriod</strong> — is the max staleness for a feed. If the
varianceThreshold was not exceeded but a set number of seconds have passed,
the oracle will respond on-chain. This should almost always be used with
varianceThreshold to ensure your feed is updating as expected and not stale
for another reason.</p></li></ul><p>💡 <strong>NOTE</strong>: See the
<a href="https://docs.rs/switchboard-v2/latest/switchboard_v2/aggregator/struct.AggregatorAccountData.html#method.check_staleness" target="_blank" rel="noopener noreferrer">check_staleness</a>
function in the rust crate when integrating.</p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="oracle-consensus-1">Oracle Consensus<a href="#oracle-consensus-1" class="hash-link" aria-label="Direct link to Oracle Consensus" title="Direct link to Oracle Consensus">​</a></h3><p>Configure how many oracles are assigned to a request and how many must respond
to accept a result.</p><ul><li><p><strong>oracleRequestBatchSize</strong> — sets the number of oracles assigned to each
update request. The quickest way to increase feed security is to request more
oracles each update round because it requires a higher degree of oracle
collusion in order to affect the on-chain result. In reality, this increases
the overall cost of a feed so it’s a careful consideration for feed operators
when configuring a feed.</p></li><li><p><strong>minOracleResults</strong> — set the minimum number of oracles that must respond
before accepting a result on-chain. This ensures you have a sufficient data
set before the on-chain program takes the median of the oracle responses.</p></li></ul><p>The number of oracles assigned to an update request should always be less than
the number of oracles required to respond. There are a variety of reasons that
may cause an oracle response to fail, such as Solana network degradation,
individual oracle network issues, or transaction spamming. Your feed’s lease is
only deducted when a round was successfully closed based on the feed’s
minOracleResults.</p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="cost">Cost<a href="#cost" class="hash-link" aria-label="Direct link to Cost" title="Direct link to Cost">​</a></h3><p>The two main methods to reduce a feeds cost is to:</p><ul><li><p>increase the <strong><em>minUpdateDelay</em></strong> so updates are requested less often</p></li><li><p>add a <strong><em>varianceTolerance</em></strong> so changes are only reported when a given
percentage change threshold is reached. This will greatly reduce the number of
updates on-chain during periods of low volatility so if you are using a
staleness check in your on-chain program, make sure to pair it with
<strong><em>forceReportPeriod</em></strong> so a value is always reported after a given staleness
interval.</p></li></ul><p>Another way to reduce cost is to set the feed authority to a DAO and share the
feed cost with other on-chain consumers. A DAO can be used to vote on feed
changes and can help democratize data on-chain. If you’re using a public data
feed, consider contributing to the feeds lease to extend its lifetime.</p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="redundancy">Redundancy<a href="#redundancy" class="hash-link" aria-label="Direct link to Redundancy" title="Direct link to Redundancy">​</a></h3><p>While Switchboard feeds have a proven track record, no system is fault tolerant
without some level of redundancy. If possible, you should pair a Switchboard
feed with another oracle provider or a TWAP feed to ensure you are viewing
reliable data. Stay tuned for a future article on advanced data feed usages.</p><h2 class="anchor anchorWithStickyNavbar_g2jJ" id="recommended-feed-configuration">Recommended Feed Configuration<a href="#recommended-feed-configuration" class="hash-link" aria-label="Direct link to Recommended Feed Configuration" title="Direct link to Recommended Feed Configuration">​</a></h2><p>The following table highlights some recommended settings. This will not
encompass all use cases — use at your own discretion. Find us on Discord to
answer any configuration questions.</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/2000/1*Xbs8jnDAnkFRwfK3EiGX9A.png" class="img_eYgV"></p><h2 class="anchor anchorWithStickyNavbar_g2jJ" id="feed-maintenance">Feed Maintenance<a href="#feed-maintenance" class="hash-link" aria-label="Direct link to Feed Maintenance" title="Direct link to Feed Maintenance">​</a></h2><p>The following highlights some basic maintenance you should employ when working
with a Switchboard feed.</p><ul><li><p><strong>Monitor Lease Funds</strong> — you should monitor your feeds lease account for low
balances. When a feed’s lease is emptied, it will no longer process new
updates until it has enough to reward the oracles processing the update. We
are working with a few web3 messaging services to enable wallet notifications
when leases are low on funds.</p></li><li><p><strong>Monitor Crank Eviction</strong> — if a lease is emptied, it will also be evicted
from its crank. Switchboard feeds act like public utilities where anyone is
free to re-push it to a crank, as long as it doesn’t have <strong>disableCrank</strong> set
to true.</p></li><li><p><strong>Monitor Data Sources</strong> — Sometimes APIs change or move. High availability
feeds should have some basic routine health checks to ensure their on-chain
data is updating as expected.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_g2jJ" id="integration-checklist">Integration Checklist<a href="#integration-checklist" class="hash-link" aria-label="Direct link to Integration Checklist" title="Direct link to Integration Checklist">​</a></h2><p>The <a href="https://crates.io/crates/switchboard-v2" target="_blank" rel="noopener noreferrer">switchboard-v2</a> crate is used to
integrate Switchboard into your on-chain programs. You can also view some
<a href="https://github.com/switchboard-xyz/switchboard-v2/tree/main/programs" target="_blank" rel="noopener noreferrer">example programs in the switchboard-v2 repo</a>.</p><ul class="contains-task-list containsTaskList_AFqK"><li class="task-list-item"><p><input type="checkbox" disabled=""> <!-- -->Check aggregator is owned by the Switchboard program</p></li><li class="task-list-item"><p><input type="checkbox" disabled=""> <!-- -->Check the latest round has more oracle responses than the minOracleResults
<a href="https://docs.rs/switchboard-v2/latest/switchboard_v2/aggregator/struct.AggregatorAccountData.html#method.get_result" target="_blank" rel="noopener noreferrer"><strong>(get_result)</strong></a></p></li><li class="task-list-item"><p><input type="checkbox" disabled=""> <!-- -->Optional, check the feed has not exceeded a given confidence interval
<a href="https://docs.rs/switchboard-v2/latest/switchboard_v2/aggregator/struct.AggregatorAccountData.html#method.check_confidence_interval" target="_blank" rel="noopener noreferrer"><strong>(check_confidence_interval)</strong></a></p></li><li class="task-list-item"><p><input type="checkbox" disabled=""> <!-- -->Optional, check the feed has been updated recently
<a href="https://docs.rs/switchboard-v2/latest/switchboard_v2/aggregator/struct.AggregatorAccountData.html#method.check_staleness" target="_blank" rel="noopener noreferrer"><strong>(check_staleness)</strong></a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_g2jJ" id="twaps-and-historical-data">TWAPs and Historical Data<a href="#twaps-and-historical-data" class="hash-link" aria-label="Direct link to TWAPs and Historical Data" title="Direct link to TWAPs and Historical Data">​</a></h2><p>Switchboard feed owners can elect to add a history buffer to their feed. This
will automatically store the last <strong>N</strong> accepted results on-chain, where N is
configurable by the user from 1 to 350,000 samples, with the current Solana
account size limits. On-chain consumers can also read from the history buffer
and validate a subset of the history to ensure the current oracle price has not
skewed too far from the recent samples.</p><p>Once a feed has a history buffer, anyone can create a separate TWAP feed that
reads the history buffer and calculates the time weighted average. This is
useful for feeds that may have low liquidity and suffer from frequent price
swings.</p><p>More advanced usages of TWAP include the ability to source the TWAP price at
settlement each week. Let us say we’re an options protocol with contracts
settling at 5PM UTC every Friday and we need a way to source the 1hr TWAP
leading up to settlement. We also need to ensure that value is always calculated
for that 1hr window so our liquidators are using the most accurate price
observed on-chain. With Switchboard, you can build a feed that will always
resolve to that 1hr window each week. You can see it in action here on devnet.
<a href="https://switchboard.xyz/explorer/2/9wChHmbtuLbjGYt9tdH7guLY9zaqT56veSxTba18k5N3" target="_blank" rel="noopener noreferrer">https://switchboard.xyz/explorer/2/9wChHmbtuLbjGYt9tdH7guLY9zaqT56veSxTba18k5N3</a></p><p>Switchboard data feeds aim to be as general as possible to meet all use cases.
If you require a more complicated data feed, do not hesitate to reach out
because we may be able to build a custom solution that will benefit not only you
but other data feed users.</p><h2 class="anchor anchorWithStickyNavbar_g2jJ" id="feed-creation-walkthrough">Feed Creation Walkthrough<a href="#feed-creation-walkthrough" class="hash-link" aria-label="Direct link to Feed Creation Walkthrough" title="Direct link to Feed Creation Walkthrough">​</a></h2><p>I’m a brand new lending protocol and I need a new data feed for XYZ. Let’s walk
through some considerations I might have for how to publish this feed.</p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="queue-selection-1">Queue Selection<a href="#queue-selection-1" class="hash-link" aria-label="Direct link to Queue Selection" title="Direct link to Queue Selection">​</a></h3><p>This protocol will obviously be successful and have a significant total value
locked (TVL) so I should choose a secure queue. I look at a queue that already
has an XYZ feed but I notice the queue isn’t as secure as I need; maybe it has a
low minimum stake requirement for oracles or doesn’t slash oracles for
misreporting. So I check the Switchboard DAO and find a queue that requires
oracles to stake 10 SOL, has slashing enabled, requires feeds to be permitted to
join, and has a proven track record of honest reporting … perfect, we found the
queue we’ll create the feed for.</p><p>💡 <strong>NOTE</strong>: Data feed owners can always move their feed to a new queue after
creation.</p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="data-source-diversity-1">Data Source Diversity<a href="#data-source-diversity-1" class="hash-link" aria-label="Direct link to Data Source Diversity" title="Direct link to Data Source Diversity">​</a></h3><p>Next, we’ll need to find where to source the data. I see 4 centralized exchanges
and 2 decentralized exchanges. Upon further inspection, I notice one of the CEXs
has questionable volume and one of the DEXs has no volume — so we should ignore
these sources. So we’ll create the feed with 3 CEXs and 1 DEX. This is good but
let’s see if we can do better. We see theres a Saber pool for this asset so we
can use the
<a href="https://docs.switchboard.xyz/api/tasks#lpexchangeratetask" target="_blank" rel="noopener noreferrer">lpExchangeRateTask</a>
to fetch the price. We can also use the
<a href="https://docs.switchboard.xyz/api/tasks#jupiterswaptask" target="_blank" rel="noopener noreferrer">jupiterSwapTask</a> to
aggregate through various on-chain sources and get us the best price. Awesome,
we have 3 CEXs, 1 DEX, a Saber pool source, and a Jupiter Swap source.</p><p>We want the feed result to be calculated with enough sources so we have an
accurate depiction of the price but if we keep it too strict, a single source
failing could halt the feed — maybe one of the CEX sources had a data center
outage. Your <strong>minJobResults</strong> should be at least one less than the total number
of sources to account for this. To give us enough margin, we’ll set ours to 4,
so 4 out of 6 sources have to respond in order for the oracle to publish a price
update.</p><p>We notice the majority of the volume for this source is on a single CEX where
the majority of price discovery occurs — we should definitely weigh this source
higher than the rest. Here’s what that may look like.</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/2000/1*2rrHzP2TjiKlpr9p7dMDEw.png" class="img_eYgV"></p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="data-availability-1">Data Availability<a href="#data-availability-1" class="hash-link" aria-label="Direct link to Data Availability" title="Direct link to Data Availability">​</a></h3><p>A lending protocol may not need the most up-to-date prices as compared to a
trading platform. So we will set the <strong>minUpdateDelaySeconds</strong> to 15. This
should be fast enough for our lending platform — we can always adjust if needed.</p><p>We’re a lending protocol on-chain so we need the data to be readily available —
so we will choose to push the feed onto a crank to enable automatic updates. The
crank is an incentivisation mechanism to regularly schedule feed updates. A
sport betting platform may opt-out of a crank since they will only need the data
when an event is settled.</p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="oracle-consensus-2">Oracle Consensus<a href="#oracle-consensus-2" class="hash-link" aria-label="Direct link to Oracle Consensus" title="Direct link to Oracle Consensus">​</a></h3><p>We’re planning on securing financial capital with our data feeds so we need to
ensure a malicious oracle cannot skew the price feed in its favor. To do this we
will set the <strong>oracleRequestBatchSize</strong> to at least 8. This means 5+ oracles
would have to collude in order to skew a feeds accepted value on-chain; remember
we’re using the median and not the average as the final result. We’ll then set
<strong>minOracleResults</strong> to 7 to account for any oracle networking issues that may
prevent them from responding. If only 7 oracles respond, at least 4 will need to
be acting in good faith to produce an honest result — which is a very reasonable
assumption to make since we selected our queue carefully.</p><h3 class="anchor anchorWithStickyNavbar_g2jJ" id="cost-1">Cost<a href="#cost-1" class="hash-link" aria-label="Direct link to Cost" title="Direct link to Cost">​</a></h3><p>Woohoo, we’re almost done. We’ve built the job definitions, configured and tuned
the settings, so we head over to the Switchboard publisher to build the feed. We
get to checkout and notice the cost may be a bit high for a lending protocol
that is just starting out. No worries, let’s look at some ways to conserve cost.</p><p>Let’s look at <strong>minUpdateDelaySeconds.</strong> Updating this feed every 15 seconds may
be a bit overkill. We can increase this to 30 to double the length of the feed.</p><p>The XYZ feed is a relatively low volatility feed, meaning the prices updated
on-chain may be the same or about the same each update round. To account for
this we can set the <strong>varianceThreshold</strong> to 0.1%, which instructs the oracles
to skip reporting a value if the value hasn’t differed by 0.1% since the last
reported value on-chain. This will greatly extend the life of your feed but
makes it hard to estimate the length of time left on the feed since it will
depend on the feeds volatility and market conditions. Our feed will now only
incur a cost when a feeds value has changed significantly.</p><p>Great, we’ve found some ways to reduce cost without sacrificing security. But
what if the XYZ asset suffers some loss of interest and reduce volatility? Your
feed may fail to update for hours on end if the price hasn’t moved by the set
varianceThreshold. This can be mitigated by setting a <strong>forceReportPeriod</strong>,
which instructs the oracles to always report a result on-chain even if the
variance threshold wasn’t exceeded, or max staleness. We will set
<strong>forceReportPeriod</strong> to 900 so the feed will always report a value on-chain
every 15minutes. When integrating on-chain, we should always be checking if the
feed was updated within the forceReportPeriod interval to ensure the feed is
healthy.</p><h2 class="anchor anchorWithStickyNavbar_g2jJ" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>This was just a basic overview of how to think about configuring a feed to meet
your use case. Each on-chain application will have their own set of requirements
for how often a feed needs to be updated and what level of security is needed.
Switchboard has provided the tools to generalize feed creation to meet most
developers use cases. Please stop by the Discord with any questions on
configuring or integrating Switchboard feeds.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2022/08/29/Switchboard-360-Looking-Back-Forward-and-All-Around"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Switchboard 360: Looking Back, Forward and All Around</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2022/07/13/Verifiable-Randomness-on-Solana"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Verifiable Randomness (VRF) on Solana</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"></div></footer></div>
<script src="/assets/js/runtime~main.d439857d.js"></script>
<script src="/assets/js/main.df7f9c98.js"></script>
</body>
</html>